<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Crop Image Example</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" rel="stylesheet">
  
  <!-- Cropper.js CSS -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css" rel="stylesheet">

  <style>
    img {
      max-width: 100%;
    }
    #preview {
      width: 100%;
      height: auto;
    }
  </style>
</head>
<body class="bg-light">

<div class="container py-5">
  <h2 class="text-center mb-4">Crop Image using jQuery + Cropper.js</h2>
  
  <!-- File input -->
  <div class="form-group">
    <label>Select an Image:</label>
    <input type="file" id="inputImage" class="form-control-file">
  </div>

  <!-- Image area for cropping -->
  <div class="mb-3">
    <img id="image" src="" alt="Choose image" style="max-width: 100%; display: none;">
  </div>

  <!-- Crop and Download Buttons -->
  <button id="cropBtn" class="btn btn-primary mb-3" disabled>Crop</button>

  <!-- Preview Result -->
  <div>
    <h5>Cropped Image:</h5>
    <canvas id="previewCanvas"></canvas>
  </div>
</div>

<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>

<!-- Cropper.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>

<script>
  let cropper;
  const image = document.getElementById('image');
  const input = document.getElementById('inputImage');
  const cropBtn = document.getElementById('cropBtn');
  const previewCanvas = document.getElementById('previewCanvas');

  input.addEventListener('change', function (e) {
    const files = e.target.files;
    const done = (url) => {
      input.value = '';
      image.src = url;
      image.style.display = 'block';
      if (cropper) cropper.destroy();
      cropper = new Cropper(image, {
        aspectRatio: 1,
        viewMode: 1
      });
      cropBtn.disabled = false;
    };

    if (files && files.length > 0) {
      const reader = new FileReader();
      reader.onload = () => done(reader.result);
      reader.readAsDataURL(files[0]);
    }
  });

  cropBtn.addEventListener('click', function () {
    if (cropper) {
      const canvas = cropper.getCroppedCanvas({
        width: 200,
        height: 200,
      });
      previewCanvas.width = 200;
      previewCanvas.height = 200;
      const ctx = previewCanvas.getContext('2d');
      ctx.clearRect(0, 0, previewCanvas.width, previewCanvas.height);
      ctx.drawImage(canvas, 0, 0);
    }
  });
</script>

</body>
</html>